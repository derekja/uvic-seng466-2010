LogBook for Derek

Jan 13 notes (moved in from previous page)

--I went through the L298 module hardwired test procedures to understand the wiring. This is with one of the small motors with a fan on it so that I can tell direction.
--I hooked up the air hogs batteries, one to the arduino board and one to the L298 board.
--remember to tie the grounds together!!!
--now working with a small motor, spins forward at high speed for 1 sec, backwards halfspeed for one sec.
-- identified switch 1 outputs on joystick, verified function on multimeter
-- installed subclipse to use our google code SVN for checkin
-- created a test2 project in SVN

    -- version 1 is the version with no joystick input that just does the forward/backward spin
    -- version 2 reads the joystick input (turn right/left only for now.. proof of concept) and then runs the motor forward (right) or backward (left) depending on angle

-- the two magic lines to enable Serial.print in eclipse! right after the includes
"extern "C" void cxa_pure_virtual(void);
void cxa_pure_virtual(void) {}"
-- note that on the joystick that full left is 1024 and full right is 0, need to /4 to get into the same scale as motor output and 255-x for right hand motion (to put 0 in the center of the scale)
-- to read serial from within eclipse you can install the rxtx library from qbang.org. That was down today, so I've been using the serial monitor in the arduino IDE. You need to close the monitor to load the board.
-- note that the small wires make VERY poor connections. We need to come up with better jumper solutions than in my little test today.

Jan 20

-- created an introduction and test scenario document for project 1

Jan 21

-- worked on syncing up to the SVN for the LED and sonar work that Jackson did


-- worked on trying to diagnose a battery problem. Concluded that the dying battery is actually now dead.

-- need a couple of pieces of hardware: header pins for 2nd arduino board, 2nd breadboard

-- put servo motor onto digital pin 10, datasheet: http://www.hitecrcd.com/servos/show?name=HS-55

-- having problems with the servo sample code. Our servo just spins in circles regardless of the value on the pin!

-- OK, using my test2 playground project I finally have it reacting. This is using the pulse width method, not the servo library. I still have something weird going on in the servo library.

-- pulse width is going to be really hard to control accurately without our RTOS.

Jan 22

-- worked up a TODO list with Riley and Jackson

-- created a Project1Remote project to hold the code for the effector

-- fighting with interrupt code. Think I'm finally understanding. I'm going to abandon the servo library in favour of hand-written interrupt code, at least in part so as to understand it better.

-- using interrupt 4 so as not to conflict with the sonar

-- re-wired the joystick that had been unsoldered (!?!)

Jan 23

-- trading email with Jackson about the problem other groups are having with sonar and motors (arduino libraries use multiple interrupts)

-- weird, I get servo motor jumps on connecting and disconnecting the serial port monitor

-- wow! initializing the serial port re-starts everything! I get serial.print statements out of my initialization routine on connecting the serial port. When I purposely put in a motor jump that gets called when I disconnect also, so I gather that the board is reset whenever the serial connection changes...

-- OK, decided to put the servo on timer5 so that it doesn't kill any of the PWMs that we want to use for the regular motors. I've put it on pin40.

-- noticed, BTW, that the PWM pins I was using for the motor come off of timer3, I think. At least they are pins OC3B and OC3C. I don't know if that conflicts with the timer for sonar, but we'll see.

-- cripes, having interrupt problems. Checking in and going home. It's been a long day here...

Jan 24

-- OK, been hitting the interrupts all afternoon and it's just not working. Here are some of the problems:
  -- I can't seem to get a waveform to output without doing it explicitly in the interrupts
  -- when in the interrupts I can set fast PWM modes with a preset TOP, but I can't get either ICRn or OCRRnA TOP values to be registered
  -- could not get digital pin 40 to behave properly, so I dropped back to timer 4 and PWM 7
  -- confused by the fact that I pinMode to 7, but I DDRH |= _BV(DDH4) which is actually pin 16
-- got the logic analyzer figured out so that I can at least watch the pin outputs directly now

Jan 25

-- spent forever convinced that I was not able to write 16 bit values to the register.
-- aarg. Making no progress on this. going home.

Jan 26

-- ok, fresh look at the problem and it still appears that I am not getting the high byte written but I have no idea why

-- finally, the light breaks through the clouds!!!

-- the arduino libraries are the culprit here. I can make everything work without them present, but if I even call init() then the OCR4A register is screwed. Even if I call no other arduino library in the entire program. ICR4 is usable, so there might be a workaround, but how frustrating.

from todo list:

Derek - due tues-- move servo into an interrupt (like the sonar is)

due Tues -- integrate servo and motor control into the main project (depends on servo integ)

-- working on radio. Not working on the main remote board, so using the open board to try and make a minimal radio project
-- OK basic radio working! still need to move it into the main project and wire the other board...

-- wired into the remote board now. moved pins 7 and 8 to 42 and 43 from Neil's wiring and put it on IRQ4 (pin 19)

-- the servo was working as well, but now it only works one direction! It smells smoky also. I think there is a hardware problem there. Need to find a new one tomorrow.

-- the radio is broadcasting to the base station that Neil set up and is sending sonar readings!

Jan 27

-- got a new servo and wired it in, this one has end stops, so it's a bit harder to tell what it's doing. The circular wheel on the top doesn't help either.
